# 実装計画: Spreadsheet Sample

## 概要

本実装計画は、Spreadsheet Sampleスプレッドシートアプリケーションを段階的に構築するためのタスクリストです。Ralphループ戦略に従い、Engine層（Pure Logic）を優先的に実装し、各ステップでテストを追加して正確性を検証します。最後にUI層を実装し、全体を統合します。

## タスク

- [x] 1. プロジェクト初期化
  - Vite + React + TypeScript + Vitestの環境構築
  - fast-check、React Testing Library、Tailwind CSSをインストール
  - 不要なボイラープレートを削除
  - ディレクトリ構造を作成
  - vite.config.ts、vitest.config.ts、tailwind.config.jsを設定
  - _要件: 10.5_

- [x] 2. Engine実装1（基本構造）
  - [x] 2.1 基本型定義を作成
    - CellAddress、CellValue、CellError、ASTNode、CellData型
    - _要件: 4.1, 4.2, 5.1, 9.1, 9.2_
  
  - [x] 2.2 アドレス変換ユーティリティを実装
    - parseAddress、formatAddress関数
    - _要件: 1.2, 1.3, 5.1_
  
  - [x] 2.3 アドレス変換のユニットテストを作成
    - 有効/無効なアドレスのテスト
    - _要件: 1.2, 1.3_
  
  - [x] 2.4 SpreadsheetEngineの基本構造を作成
    - セルデータ管理とメソッドのスケルトン
    - _要件: 3.5, 4.1_

- [x] 3. Engine実装2（パーサー基礎）
  - [x] 3.1 FormulaParserクラスを実装
    - 数値、演算子、セル参照、範囲、関数のパース
    - _要件: 4.1, 4.2, 4.3, 4.4, 5.1, 6.1, 6.2, 6.3_
  
  - [x] 3.2 パーサーのプロパティテストを作成
    - プロパティ8, 9, 10, 13（最低100回反復）
    - _検証: 要件 4.1, 4.2, 4.3, 4.4, 6.1_
  
  - [x] 3.3 パーサーのユニットテストを作成
    - エッジケースと具体例
    - _要件: 5.3, 6.4_

- [x] 4. Engine実装3（セル参照と評価）
  - [x] 4.1 CellEvaluatorクラスを実装
    - 評価、参照解決、関数、エラー処理
    - _要件: 4.3, 5.1, 5.2, 5.3, 5.4, 6.2, 6.3, 6.4, 6.5, 9.1, 9.3_
  
  - [x] 4.2 評価器のプロパティテストを作成
    - プロパティ11, 12, 14, 15, 16, 23, 24（最低100回反復）
    - _検証: 要件 5.1, 5.2, 5.4, 6.2, 6.3, 6.5, 9.1, 9.3_
  
  - [x] 4.3 評価器のユニットテストを作成
    - エッジケースと具体例
    - _要件: 5.3, 6.4_

- [x] 5. チェックポイント - パーサーと評価器のテスト確認
  - すべてのテストがパスすることを確認
  - 質問があればユーザーに確認

- [x] 6. Engine実装4（依存関係解決）
  - [x] 6.1 DependencyGraphクラスを実装
    - 依存関係の追加/削除/取得/トポロジカルソート
    - _要件: 7.1, 7.2, 7.4_
  
  - [x] 6.2 CycleDetectorクラスを実装
    - 循環参照検出（DFSベース）
    - _要件: 8.1, 8.2, 8.3_
  
  - [x] 6.3 依存関係グラフのプロパティテストを作成
    - プロパティ17, 19, 20, 21, 22（最低100回反復）
    - _検証: 要件 7.1, 7.4, 8.1, 8.2, 8.3_
  
  - [x] 6.4 依存関係グラフのユニットテストを作成
    - 基本ケース
    - _要件: 7.1, 7.2_
  
  - [x] 6.5 循環参照検出器のユニットテストを作成
    - 単純/複雑なサイクル、サイクルなし
    - _要件: 8.1, 8.2_

- [x] 7. Engine実装5（統合と再計算）
  - [x] 7.1 SpreadsheetEngineの再計算ロジックを実装
    - 完全な再計算フロー
    - _要件: 7.1, 7.2, 8.1, 8.2_
  
  - [x] 7.2 SpreadsheetEngineのプロパティテストを作成
    - プロパティ6, 18, 25（最低100回反復）
    - _検証: 要件 3.5, 7.2, 9.4_
  
  - [x] 7.3 SpreadsheetEngineのユニットテストを作成
    - 連鎖再計算、循環参照、エラー伝播
    - _要件: 7.2, 5.4, 8.1, 8.2, 9.4_

- [x] 8. チェックポイント - Engine層の完全テスト確認
  - すべてのEngine層テストがパスすることを確認
  - 循環参照と連鎖再計算のテストを確認
  - テストカバレッジ100%を確認
  - 質問があればユーザーに確認

- [x] 9. UI実装1（状態管理）
  - [x] 9.1 useSpreadsheetカスタムフックを実装
    - Engine管理、状態管理、イベントハンドラー
    - _要件: 2.1, 2.2, 2.4, 3.1, 3.2, 3.4, 3.5, 3.6_
  
  - [x] 9.2 状態管理のプロパティテストを作成
    - プロパティ1, 2, 3, 4, 5, 7（最低100回反復）
    - _検証: 要件 2.2, 2.4, 3.1, 3.2, 3.4, 3.6_

- [x] 10. UI実装2（コンポーネント）
  - [x] 10.1 FormulaBarコンポーネントを実装
    - 選択中のセル番地の表示
    - セルの生の入力内容の表示
    - 数式バーでの編集機能
    - Tailwind CSSでスタイリング
    - _要件: 11.1, 11.2, 11.3, 11.4_
  
  - [x] 10.2 Cellコンポーネントを実装
    - 表示/編集モード、イベント処理
    - 空セルは空白、値0は"0"を表示
    - エラー値の視覚的表示（赤色ハイライト）
    - Tailwind CSSでスタイリング
    - _要件: 2.1, 3.1, 3.2, 3.3, 3.5, 3.6, 9.4, 12.1, 12.2, 12.3_
  
  - [x] 10.3 Gridコンポーネントを実装
    - ヘッダー、グリッド、ナビゲーション
    - Tailwind CSSでスタイリング
    - _要件: 1.1, 1.2, 1.3, 1.4, 2.2_
  
  - [x] 10.4 UIコンポーネントのユニットテストを作成
    - FormulaBarのレンダリングとイベントハンドラーのテスト
    - Cellコンポーネントのレンダリングとイベントハンドラーのテスト
    - Gridコンポーネントのレンダリングテスト
    - 空セルと値0の表示の区別をテスト
    - _要件: 1.1, 1.2, 1.3, 1.4, 2.1, 3.1, 3.2, 11.1, 11.2, 11.3, 12.1, 12.3_

- [x] 11. UI実装3（統合）
  - [x] 11.1 App.tsxを実装
    - FormulaBarコンポーネントの配置
    - Gridコンポーネントの配置
    - useSpreadsheetフックの使用
    - 全体のレイアウト
    - Tailwind CSSでスタイリング
    - _要件: 1.4, 11.1_
  
  - [x] 11.2 スタイリングの最終調整
    - Tailwind CSS設定
    - 数式バーのレイアウト
    - エラー表示の視覚的確認
    - 空セルと値0の表示の確認
    - _要件: 9.4, 12.3_

- [x] 12. 最終確認
  - すべてのテストがパスすることを確認
  - 循環参照と連鎖再計算のテストを確認
  - ビルドエラーがないことを確認
  - Engine層のテストカバレッジ100%を確認
  - すべてのプロパティがテストされていることを確認
  - 質問があればユーザーに確認

## 注意事項

- すべてのテストタスクは必須です
- 各タスクのテストがすべてパスするまで次のタスクに進めません
- 各プロパティテストは最低100回の反復を実行してください
- 各テストには設計書のプロパティを参照するタグを含めてください
- Engine層のテストカバレッジ100%を目指してください
- UI層は複雑なロジックを持たせず、Engineの状態を描画するだけにしてください
- チェックポイントでは必ずすべてのテストがパスしていることを確認してください
- Ralphループ戦略に従い、Engine層を優先的に実装し、徹底的にテストしてください
- アプリケーションの動作をplaywrightでテストしてください
